apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    model.aibrix.ai/name: qwen3-32b
    model.aibrix.ai/port: "8000"
  name: qwen3-32b
  namespace: default
spec:
  replicas: 2
  selector:
    matchLabels:
      model.aibrix.ai/name: qwen3-32b
  template:
    metadata:
      labels:
        model.aibrix.ai/name: qwen3-32b
    spec:
      containers:
        - name: sglang-server
          image: kvcache-container-image-hb2-cn-beijing.cr.volces.com/aibrix/sglang:v0.4.9.post3-cu126-nixl-v0.4.1
          command: ["sh", "-c"]
          args:
            - |
              python3 -m sglang.launch_server \
                --model-path /models/Qwen3-32B \
                --served-model-name qwen3-32b \
                --host 0.0.0.0 \
                --port 8000 \
                --trust-remote-code \
                --enable-metrics \
                --mem-fraction-static 0.8 \
                --log-level debug
          resources:
            limits:
              nvidia.com/gpu: 1
          volumeMounts:
            - name: model-vol
              mountPath: /models
              readOnly: true
            - mountPath: /dev/shm
              name: shared-mem
          securityContext:
            capabilities:
              add:
                - IPC_LOCK
      volumes:
        - name: model-vol
          hostPath:
            path: /data01/models
            type: Directory
        - emptyDir:
            medium: Memory
          name: shared-mem
      nodeSelector:
        kubernetes.io/hostname: 192.168.0.6